CREATE DATABASE latter2;
USE latter2;



CREATE TABLE `asistencia` (
  `IDPERSONA` int(11) NOT NULL,
  `FECHA` date NOT NULL,
  `EDO` int(11) NOT NULL DEFAULT 0,
  `ESTADO` varchar(8) NOT NULL DEFAULT 'AUSENTE'
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


INSERT INTO `asistencia` (`IDPERSONA`, `FECHA`, `EDO`, `ESTADO`) VALUES
(1, '2020-05-14', 2, 'AUSENTE'),
(2, '2020-05-14', 2, 'AUSENTE'),
(4, '2020-06-10', 2, 'AUSENTE');



CREATE TABLE `cuentas` (
  `IDPERSONA` int(11) NOT NULL,
  `USUARIO` varchar(11) NOT NULL,
  `CONTRASENA` varchar(128) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


INSERT INTO `cuentas` (`IDPERSONA`, `USUARIO`, `CONTRASENA`) VALUES
(1, 'CARPAL0909', '$2y$10$jEc2lEH5UqQwAT9QltkOu.MfS2r53t03Mrn3t4ruVcQ6I.Qd5vVG6'),
(2, 'EDILOP0808', '$2y$10$y7cB9E4JidYpekkvLH9dM.DHtqS3eKssjAXqfsDFbMAyW6RIf9OHu'),
(4, 'EDIBER08085', '$2y$10$WVsvHoo5/E6WerEymybDZOheaoPnu4Jj6naGGU97zrA6jniG0ag66');


CREATE TABLE `empleado` (
  `IDPERSONA` int(11) NOT NULL,
  `PUESTO` varchar(20) DEFAULT NULL,
  `HORAENTRADA` time NOT NULL,
  `HORASALIDA` time NOT NULL,
  `DESCANSO` varchar(9) NOT NULL,
  `ANOIN` year(4) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


INSERT INTO `empleado` (`IDPERSONA`, `PUESTO`, `HORAENTRADA`, `HORASALIDA`, `DESCANSO`, `ANOIN`) VALUES
(1, 'ADMINISTRADOR', '09:10:00', '18:10:00', 'DOMINGO', 2020),
(2, 'GERENTE', '11:11:00', '14:22:00', 'LUNES', 2020),
(4, 'SERVICIO AL CLIENTE', '11:11:00', '14:22:00', 'SABADO', 2020);



CREATE TABLE `personas` (
  `ID` int(11) NOT NULL,
  `NOMBRE` varchar(35) NOT NULL,
  `APELLIDOPA` varchar(20) NOT NULL,
  `APELLIDOMA` varchar(20) NOT NULL,
  `FECHANA` date NOT NULL,
  `SEXO` varchar(6) NOT NULL,
  `CURP` varchar(18) NOT NULL,
  `RFC` varchar(13) NOT NULL,
  `DIRECCION` varchar(50) NOT NULL,
  `TELEFONO` bigint(20) NOT NULL,
  `EMAIL` varchar(30) NOT NULL,
  `NSEGURO` varchar(20) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


INSERT INTO `personas` (`ID`, `NOMBRE`, `APELLIDOPA`, `APELLIDOMA`, `FECHANA`, `SEXO`, `CURP`, `RFC`, `DIRECCION`, `TELEFONO`, `EMAIL`, `NSEGURO`) VALUES
(1, 'CARLOS JONATHAN', 'PALMA', 'LOPEZ', '1999-09-09', 'HOMBRE', 'LOPC990909HMCPLR08', 'LOPC99090908', 'GUADALUPE VICTORIA #103', 7227844903, 'charly.palma99@gmail.com', '199909'),
(2, 'LUISE', 'LEBLANC', 'VALLIERE', '2000-08-06', 'MUJER', 'LEVL0000806MMLVI00', 'LEVL0000806', 'OTRO MUNDO', 1234567890, 'zero_luise@gg.mx', '122333'),
(4, 'EDITH', 'LOPEZ', 'BERNAL', '1998-08-08', 'MUJER', 'LOBE980808MMERI108', 'LOBE98080811', 'CON CHARLY U', 7227845678, 'carlos_jlp@hotmail.com', '711112');

CREATE TABLE `reportes` (
  `IDPERSONA` int(11) NOT NULL,
  `FECHA` date NOT NULL,
  `HORA` time NOT NULL,
  `DESCRIPCION` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL,
  `MONTO` decimal(6,2) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


INSERT INTO `reportes` (`IDPERSONA`, `FECHA`, `HORA`, `DESCRIPCION`, `MONTO`) VALUES
(1, '2020-04-06', '14:25:20', 'RETARDO', '50.00'),
(1, '2020-05-14', '09:17:57', 'RETARDO', '50.00'),
(1, '2020-05-14', '09:18:08', 'RETIRO TEMPRANO', '60.00'),
(1, '2020-05-16', '22:26:02', 'AUSENTE', '200.00'),
(2, '2020-05-14', '14:17:51', 'AUSENTE', '200.00'),
(2, '2020-05-14', '09:12:55', 'RETIRO TEMPRANO', '60.00');


ALTER TABLE `asistencia`
  ADD UNIQUE KEY `IDPERSONA` (`IDPERSONA`);

ALTER TABLE `cuentas`
  ADD UNIQUE KEY `IDPERSONA` (`IDPERSONA`),
  ADD UNIQUE KEY `USUARIO` (`USUARIO`);


ALTER TABLE `empleado`
  ADD UNIQUE KEY `IDPERSONA` (`IDPERSONA`);

ALTER TABLE `personas`
  ADD PRIMARY KEY (`ID`),
  ADD UNIQUE KEY `CURP` (`CURP`),
  ADD UNIQUE KEY `RFC` (`RFC`),
  ADD UNIQUE KEY `TELEFONO` (`TELEFONO`),
  ADD UNIQUE KEY `EMAIL` (`EMAIL`),
  ADD UNIQUE KEY `NSEGURO` (`NSEGURO`);

ALTER TABLE `reportes`
  ADD UNIQUE KEY `reportes_idpersona_fecha_descripcion_index` (`IDPERSONA`,`FECHA`,`DESCRIPCION`) USING BTREE;

ALTER TABLE `personas`
  MODIFY `ID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=6;

ALTER TABLE `asistencia`
  ADD CONSTRAINT `asistencia_ibfk_1` FOREIGN KEY (`IDPERSONA`) REFERENCES `personas` (`ID`) ON UPDATE CASCADE;

ALTER TABLE `cuentas`
  ADD CONSTRAINT `cuentas_ibfk_1` FOREIGN KEY (`IDPERSONA`) REFERENCES `personas` (`ID`) ON UPDATE CASCADE;

ALTER TABLE `empleado`
  ADD CONSTRAINT `empleado_ibfk_1` FOREIGN KEY (`IDPERSONA`) REFERENCES `personas` (`ID`) ON UPDATE CASCADE;

ALTER TABLE `reportes`
  ADD CONSTRAINT `reportes_idpersona_foreign` FOREIGN KEY (`IDPERSONA`) REFERENCES `personas` (`ID`);
COMMIT;
